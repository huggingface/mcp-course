# O Protocolo de ComunicaÃ§Ã£o

O MCP define um protocolo de comunicaÃ§Ã£o padronizado que permite que Clientes e Servidores troquem mensagens de forma consistente e previsÃ­vel. Essa padronizaÃ§Ã£o Ã© fundamental para a interoperabilidade em toda a comunidade. Nesta seÃ§Ã£o, exploraremos a estrutura do protocolo e os mecanismos de transporte utilizados no MCP.

<Tip warning={true}>

Estamos entrando nos detalhes minuciosos do protocolo MCP. VocÃª nÃ£o precisarÃ¡ conhecer todos esses detalhes para construir com o MCP, mas Ã© bom saber que eles existem e como funcionam.

</Tip>

## JSON-RPC: A Base

Em sua essÃªncia, o MCP utiliza o **JSON-RPC 2.0** como formato de mensagem para toda a comunicaÃ§Ã£o entre Clientes e Servidores. JSON-RPC Ã© um protocolo leve de chamada de procedimento remoto codificado em JSON, o que o torna:

- LegÃ­vel por humanos e fÃ¡cil de depurar
- AgnÃ³stico em relaÃ§Ã£o Ã  linguagem, permitindo implementaÃ§Ã£o em qualquer ambiente de programaÃ§Ã£o
- Bem estabelecido, com especificaÃ§Ãµes claras e ampla adoÃ§Ã£o

![tipos de mensagens](https://huggingface.co/datasets/mcp-course/images/resolve/main/unit1/5.png)

O protocolo define trÃªs tipos de mensagens:

### 1. RequisiÃ§Ãµes

Enviadas do Cliente para o Servidor para iniciar uma operaÃ§Ã£o. Uma mensagem de RequisiÃ§Ã£o inclui:
- Um identificador Ãºnico (`id`)
- O nome do mÃ©todo a ser invocado (ex: `tools/call`)
- ParÃ¢metros para o mÃ©todo (se houver)

Exemplo de RequisiÃ§Ã£o:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "weather",
    "arguments": {
      "location": "San Francisco"
    }
  }
}
```

### 2. Respostas

Enviadas do Servidor para o Cliente em resposta a uma RequisiÃ§Ã£o. Uma mensagem de Resposta inclui:
- O mesmo `id` da RequisiÃ§Ã£o correspondente
- Um `result` (para sucesso) ou um `error` (para falha)

Exemplo de Resposta com Sucesso:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "temperature": 62,
    "conditions": "Partly cloudy"
  }
}
```

Exemplo de Resposta com Erro:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32602,
    "message": "Invalid location parameter"
  }
}
```

### 3. NotificaÃ§Ãµes

Mensagens unidirecionais que nÃ£o requerem resposta. Normalmente enviadas do Servidor para o Cliente para fornecer atualizaÃ§Ãµes ou notificaÃ§Ãµes sobre eventos.

Exemplo de NotificaÃ§Ã£o:
```json
{
  "jsonrpc": "2.0",
  "method": "progress",
  "params": {
    "message": "Processing data...",
    "percent": 50
  }
}
```

## Mecanismos de Transporte

O JSON-RPC define o formato da mensagem, mas o MCP tambÃ©m especifica como essas mensagens sÃ£o transportadas entre Clientes e Servidores. Dois mecanismos principais de transporte sÃ£o suportados:

### stdio (Entrada/SaÃ­da PadrÃ£o)

O transporte stdio Ã© usado para comunicaÃ§Ã£o local, onde o Cliente e o Servidor executam na mesma mÃ¡quina:

A aplicaÃ§Ã£o Host inicia o Servidor como um subprocesso e se comunica com ele escrevendo em sua entrada padrÃ£o (stdin) e lendo de sua saÃ­da padrÃ£o (stdout).

<Tip>

**Casos de uso** para este transporte sÃ£o ferramentas locais como acesso ao sistema de arquivos ou execuÃ§Ã£o de scripts locais.

</Tip>

As principais **Vantagens** deste transporte sÃ£o: Ã© simples, nÃ£o requer configuraÃ§Ã£o de rede e Ã© seguramente isolado pelo sistema operacional.

### HTTP + SSE (Server-Sent Events) / HTTP Streamable

O transporte HTTP+SSE Ã© usado para comunicaÃ§Ã£o remota, onde o Cliente e o Servidor podem estar em mÃ¡quinas diferentes:

A comunicaÃ§Ã£o ocorre via HTTP, com o Servidor usando Server-Sent Events (SSE) para enviar atualizaÃ§Ãµes ao Cliente atravÃ©s de uma conexÃ£o persistente.

<Tip>

**Casos de uso** para este transporte sÃ£o conexÃµes com APIs remotas, serviÃ§os em nuvem ou recursos compartilhados.

</Tip>

As principais **Vantagens** deste transporte sÃ£o: funciona atravÃ©s de redes, permite integraÃ§Ã£o com serviÃ§os web e Ã© compatÃ­vel com ambientes serverless.

AtualizaÃ§Ãµes recentes no padrÃ£o MCP introduziram ou refinaram o "HTTP Streamable", que oferece mais flexibilidade ao permitir que servidores faÃ§am upgrade dinÃ¢mico para SSE para streaming quando necessÃ¡rio, mantendo a compatibilidade com ambientes serverless.

## O Ciclo de Vida da InteraÃ§Ã£o

Na seÃ§Ã£o anterior, discutimos o ciclo de vida de uma Ãºnica interaÃ§Ã£o entre um Cliente (ğŸ’») e um Servidor (ğŸŒ). Vamos agora examinar o ciclo de vida de uma interaÃ§Ã£o completa entre um Cliente e um Servidor no contexto do protocolo MCP.

O protocolo MCP define um ciclo de vida de interaÃ§Ã£o estruturado entre Clientes e Servidores:

### InicializaÃ§Ã£o

O Cliente se conecta ao Servidor e eles trocam versÃµes de protocolo e capacidades, e o Servidor responde com sua versÃ£o de protocolo suportada e capacidades.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>initialize</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>initialized</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

O Cliente confirma que a inicializaÃ§Ã£o estÃ¡ completa atravÃ©s de uma mensagem de notificaÃ§Ã£o.

### Descoberta

O Cliente solicita informaÃ§Ãµes sobre capacidades disponÃ­veis e o Servidor responde com uma lista de ferramentas disponÃ­veis.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>tools/list</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

Este processo pode ser repetido para cada ferramenta, recurso ou tipo de prompt.

### ExecuÃ§Ã£o

O Cliente invoca capacidades com base nas necessidades do Host.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>tools/call</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>notification (progresso opcional)</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

### Encerramento

A conexÃ£o Ã© fechada de forma elegante quando nÃ£o Ã© mais necessÃ¡ria e o Servidor reconhece a solicitaÃ§Ã£o de desligamento.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>shutdown</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>exit</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

O Cliente envia a mensagem final de saÃ­da para completar o encerramento.

## EvoluÃ§Ã£o do Protocolo

O protocolo MCP Ã© projetado para ser extensÃ­vel e adaptÃ¡vel. A fase de inicializaÃ§Ã£o inclui negociaÃ§Ã£o de versÃ£o, permitindo compatibilidade retroativa Ã  medida que o protocolo evolui. AlÃ©m disso, a descoberta de capacidades permite que os Clientes se adaptem Ã s caracterÃ­sticas especÃ­ficas oferecidas por cada Servidor, possibilitando uma mistura de Servidores bÃ¡sicos e avanÃ§ados no mesmo ecossistema.
