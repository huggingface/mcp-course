# Tiny Agents: ä¸€ä¸ªç”±MCPé©±åŠ¨çš„50è¡Œä»£ç çš„æ™ºèƒ½ä½“

æ—¢ç„¶æˆ‘ä»¬å·²ç»ç”¨Gradioæ„å»ºäº†MCPæœåŠ¡å™¨ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥æ¢ç´¢MCPå®¢æˆ·ç«¯ã€‚æœ¬èŠ‚åŸºäºå®éªŒé¡¹ç›®[Tiny Agents](https://huggingface.co/blog/tiny-agents)ï¼Œè¯¥é¡¹ç›®å±•ç¤ºäº†ä¸€ç§è¶…çº§ç®€å•çš„æ–¹å¼æ¥éƒ¨ç½²MCPå®¢æˆ·ç«¯ï¼Œè¿™äº›å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°åƒæˆ‘ä»¬ä¹‹å‰æ„å»ºçš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨è¿™æ ·çš„æœåŠ¡ã€‚

åœ¨è¿™ä¸ªç®€çŸ­çš„ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å¯¼ä½ å¦‚ä½•å®ç°ä¸€ä¸ªTypeScript (JS) MCPå®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥ä¸ä»»ä½•MCPæœåŠ¡å™¨é€šä¿¡ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æ„å»ºçš„åŸºäºGradioçš„æƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ã€‚ä½ å°†çœ‹åˆ°MCPå¦‚ä½•æ ‡å‡†åŒ–æ™ºèƒ½ä½“ä¸å·¥å…·çš„äº¤äº’æ–¹å¼ï¼Œä½¿Agentic AIå¼€å‘å˜å¾—æ˜¾è‘—ç®€å•ã€‚

![meme](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/tiny-agents/thumbnail.jpg)
<figcaption>å›¾ç‰‡æ¥æº https://x.com/adamdotdev</figcaption>

æˆ‘ä»¬å°†å‘ä½ å±•ç¤ºå¦‚ä½•å°†ä½ çš„tiny agentè¿æ¥åˆ°åŸºäºGradioçš„MCPæœåŠ¡å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿåˆ©ç”¨ä½ çš„è‡ªå®šä¹‰æƒ…æ„Ÿåˆ†æå·¥å…·å’Œå…¶ä»–é¢„æ„å»ºå·¥å…·ã€‚

## å¦‚ä½•è¿è¡Œå®Œæ•´æ¼”ç¤º

å¦‚æœä½ æœ‰NodeJSï¼ˆå¸¦æœ‰`pnpm`æˆ–`npm`ï¼‰ï¼Œåªéœ€åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
npx @huggingface/mcp-client
```

æˆ–è€…å¦‚æœä½¿ç”¨`pnpm`ï¼š

```bash
pnpx @huggingface/mcp-client
```

è¿™ä¼šå°†åŒ…å®‰è£…åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åæ‰§è¡Œå…¶å‘½ä»¤ã€‚

ä½ å°†çœ‹åˆ°ä½ çš„ç®€å•Agentè¿æ¥åˆ°å¤šä¸ªMCPæœåŠ¡å™¨ï¼ˆåœ¨æœ¬åœ°è¿è¡Œï¼‰ï¼ŒåŠ è½½å®ƒä»¬çš„å·¥å…·ï¼ˆç±»ä¼¼äºå®ƒå¦‚ä½•åŠ è½½ä½ çš„Gradioæƒ…æ„Ÿåˆ†æå·¥å…·ï¼‰ï¼Œç„¶åæç¤ºä½ è¿›è¡Œå¯¹è¯ã€‚

<video controls autoplay loop>
  <source src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/tiny-agents/use-filesystem.mp4" type="video/mp4">
</video>

é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹Agentè¿æ¥åˆ°ä»¥ä¸‹ä¸¤ä¸ªMCPæœåŠ¡å™¨ï¼š

- "è§„èŒƒ"çš„[æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨](https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem)ï¼Œå®ƒå¯ä»¥è®¿é—®ä½ çš„æ¡Œé¢ï¼Œ
- ä»¥åŠ[Playwright MCP](https://github.com/microsoft/playwright-mcp)æœåŠ¡å™¨ï¼Œå®ƒçŸ¥é“å¦‚ä½•ä¸ºä½ ä½¿ç”¨æ²™ç›’åŒ–çš„Chromiumæµè§ˆå™¨ã€‚

ä½ å¯ä»¥è½»æ¾åœ°å°†ä½ çš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨æ·»åŠ åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬èŠ‚åé¢æ¼”ç¤ºã€‚

> [!NOTE]
> æ³¨æ„ï¼šè¿™æœ‰ç‚¹åç›´è§‰ï¼Œä½†ç›®å‰tiny agentsä¸­çš„æ‰€æœ‰MCPæœåŠ¡å™¨å®é™…ä¸Šéƒ½æ˜¯æœ¬åœ°è¿›ç¨‹ï¼ˆå°½ç®¡è¿œç¨‹æœåŠ¡å™¨å³å°†æ¨å‡ºï¼‰ã€‚è¿™ä¸åŒ…æ‹¬æˆ‘ä»¬åœ¨localhost:7860ä¸Šè¿è¡Œçš„GradioæœåŠ¡å™¨ã€‚

æˆ‘ä»¬ç¬¬ä¸€ä¸ªè§†é¢‘çš„è¾“å…¥æ˜¯ï¼š

> å†™ä¸€é¦–å…³äºHugging Faceç¤¾åŒºçš„ä¿³å¥ï¼Œå¹¶å°†å…¶å†™å…¥æˆ‘æ¡Œé¢ä¸Šçš„"hf.txt"æ–‡ä»¶

ç°åœ¨è®©æˆ‘ä»¬å°è¯•è¿™ä¸ªæ¶‰åŠç½‘é¡µæµè§ˆçš„æç¤ºï¼š

> åœ¨Brave Searchä¸Šæœç´¢HFæ¨ç†æä¾›å•†å¹¶æ‰“å¼€å‰3ä¸ªç»“æœ

<video controls autoplay loop>
  <source src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/tiny-agents/brave-search.mp4" type="video/mp4">
</video>

è¿æ¥æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†æå·¥å…·åï¼Œæˆ‘ä»¬å¯ä»¥ç±»ä¼¼åœ°é—®ï¼š
> åˆ†æè¿™æ¡è¯„è®ºçš„æƒ…æ„Ÿï¼š"æˆ‘ç»å¯¹å–œæ¬¢è¿™ä¸ªäº§å“ï¼Œå®ƒè¶…å‡ºäº†æˆ‘æ‰€æœ‰çš„æœŸæœ›ï¼"

### é»˜è®¤æ¨¡å‹å’Œæä¾›å•†

åœ¨æ¨¡å‹/æä¾›å•†å¯¹æ–¹é¢ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹Agenté»˜è®¤ä½¿ç”¨ï¼š
- ["Qwen/Qwen2.5-72B-Instruct"](https://huggingface.co/Qwen/Qwen2.5-72B-Instruct)
- è¿è¡Œåœ¨[Nebius](https://huggingface.co/docs/inference-providers/providers/nebius)ä¸Š

è¿™äº›éƒ½æ˜¯å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®çš„ï¼åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜å°†å±•ç¤ºå¦‚ä½•æ·»åŠ æˆ‘ä»¬çš„Gradio MCPæœåŠ¡å™¨ï¼š

```ts
const agent = new Agent({
	provider: process.env.PROVIDER ?? "nebius",
	model: process.env.MODEL_ID ?? "Qwen/Qwen2.5-72B-Instruct",
	apiKey: process.env.HF_TOKEN,
	servers: [
		// é»˜è®¤æœåŠ¡å™¨
		{
			command: "npx",
			args: ["@modelcontextprotocol/servers", "filesystem"]
		},
		{
			command: "npx",
			args: ["playwright-mcp"]
		},
		// æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨
		{
			command: "npx",
			args: [
				"mcp-remote",
				"http://localhost:7860/gradio_api/mcp/sse"
			]
		}
	],
});
```

<Tip>

æˆ‘ä»¬é€šè¿‡[`mcp-remote`](https://www.npmjs.com/package/mcp-remote)åŒ…è¿æ¥åˆ°æˆ‘ä»¬çš„åŸºäºGradioçš„MCPæœåŠ¡å™¨ã€‚

</Tip>

## åŸºç¡€ï¼šLLMä¸­çš„å·¥å…·è°ƒç”¨åŸç”Ÿæ”¯æŒ

ä½¿å°†Gradio MCPæœåŠ¡å™¨è¿æ¥åˆ°æˆ‘ä»¬çš„Tiny Agentæˆä¸ºå¯èƒ½çš„æ˜¯ï¼Œæœ€è¿‘çš„LLMï¼ˆåŒ…æ‹¬é—­æºå’Œå¼€æºçš„ï¼‰éƒ½ç»è¿‡å‡½æ•°è°ƒç”¨ï¼ˆä¹Ÿç§°ä¸ºå·¥å…·ä½¿ç”¨ï¼‰çš„è®­ç»ƒã€‚è¿™ç§èƒ½åŠ›åŒæ ·æ”¯æŒæˆ‘ä»¬ä¸ä½¿ç”¨Gradioæ„å»ºçš„æƒ…æ„Ÿåˆ†æå·¥å…·çš„é›†æˆã€‚

å·¥å…·ç”±å…¶åç§°ã€æè¿°å’Œå‚æ•°çš„JSONSchemaè¡¨ç¤ºå®šä¹‰ - è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨GradioæœåŠ¡å™¨ä¸­å®šä¹‰æƒ…æ„Ÿåˆ†æå‡½æ•°çš„æ–¹å¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```ts
const weatherTool = {
	type: "function",
	function: {
		name: "get_weather",
		description: "è·å–ç»™å®šä½ç½®çš„å½“å‰æ¸©åº¦ã€‚",
		parameters: {
			type: "object",
			properties: {
				location: {
					type: "string",
					description: "åŸå¸‚å’Œå›½å®¶ï¼Œä¾‹å¦‚ï¼šæ³¢å“¥å¤§ï¼Œå“¥ä¼¦æ¯”äºš",
				},
			},
		},
	},
};
```

æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†æå·¥å…·ä¼šæœ‰ç±»ä¼¼çš„ç»“æ„ï¼Œåªæ˜¯è¾“å…¥å‚æ•°æ˜¯`text`è€Œä¸æ˜¯`location`ã€‚

æˆ‘å°†åœ¨è¿™é‡Œé“¾æ¥çš„è§„èŒƒæ–‡æ¡£æ˜¯[OpenAIçš„å‡½æ•°è°ƒç”¨æ–‡æ¡£](https://platform.openai.com/docs/guides/function-calling?api-mode=chat)ã€‚ï¼ˆæ˜¯çš„...OpenAIå‡ ä¹ä¸ºæ•´ä¸ªç¤¾åŒºå®šä¹‰äº†LLMæ ‡å‡†ğŸ˜…ï¼‰ã€‚

æ¨ç†å¼•æ“å…è®¸ä½ åœ¨è°ƒç”¨LLMæ—¶ä¼ é€’å·¥å…·åˆ—è¡¨ï¼ŒLLMå¯ä»¥è‡ªç”±è°ƒç”¨é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªè¿™äº›å·¥å…·ã€‚
ä½œä¸ºå¼€å‘è€…ï¼Œä½ è¿è¡Œè¿™äº›å·¥å…·å¹¶å°†å®ƒä»¬çš„ç»“æœåé¦ˆç»™LLMä»¥ç»§ç»­ç”Ÿæˆã€‚

> æ³¨æ„ï¼Œåœ¨åç«¯ï¼ˆåœ¨æ¨ç†å¼•æ“çº§åˆ«ï¼‰ï¼Œå·¥å…·åªæ˜¯ä»¥ç‰¹æ®Šæ ¼å¼çš„`chat_template`ä¼ é€’ç»™æ¨¡å‹ï¼Œå°±åƒä»»ä½•å…¶ä»–æ¶ˆæ¯ä¸€æ ·ï¼Œç„¶åä»å“åº”ä¸­è§£æå‡ºæ¥ï¼ˆä½¿ç”¨æ¨¡å‹ç‰¹å®šçš„ç‰¹æ®Šæ ‡è®°ï¼‰ä»¥å°†å®ƒä»¬ä½œä¸ºå·¥å…·è°ƒç”¨æš´éœ²å‡ºæ¥ã€‚

## åœ¨InferenceClientä¹‹ä¸Šå®ç°MCPå®¢æˆ·ç«¯

ç°åœ¨æˆ‘ä»¬çŸ¥é“æœ€è¿‘LLMä¸­çš„å·¥å…·æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬å®ç°å®é™…çš„MCPå®¢æˆ·ç«¯ï¼Œå®ƒå°†ä¸æˆ‘ä»¬çš„GradioæœåŠ¡å™¨å’Œå…¶ä»–MCPæœåŠ¡å™¨é€šä¿¡ã€‚

https://modelcontextprotocol.io/quickstart/client ä¸Šçš„å®˜æ–¹æ–‡æ¡£å†™å¾—ç›¸å½“å¥½ã€‚ä½ åªéœ€è¦ç”¨ä»»ä½•å…¶ä»–OpenAIå…¼å®¹çš„å®¢æˆ·ç«¯SDKæ›¿æ¢å¯¹Anthropicå®¢æˆ·ç«¯SDKçš„ä»»ä½•æåŠã€‚ï¼ˆè¿˜æœ‰ä¸€ä¸ª[llms.txt](https://modelcontextprotocol.io/llms-full.txt)ä½ å¯ä»¥è¾“å…¥åˆ°ä½ é€‰æ‹©çš„LLMä¸­ä»¥å¸®åŠ©ä½ ç¼–ç ï¼‰ã€‚

æé†’ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨HFçš„`InferenceClient`ä½œä¸ºæˆ‘ä»¬çš„æ¨ç†å®¢æˆ·ç«¯ã€‚

> [!TIP]
> å¦‚æœä½ æƒ³ä½¿ç”¨å®é™…ä»£ç è·Ÿéšï¼Œå®Œæ•´çš„`McpClient.ts`ä»£ç æ–‡ä»¶åœ¨[è¿™é‡Œ](https://github.com/huggingface/huggingface.js/blob/main/packages/mcp-client/src/McpClient.ts) ğŸ¤“

æˆ‘ä»¬çš„`McpClient`ç±»æœ‰ï¼š
- ä¸€ä¸ªæ¨ç†å®¢æˆ·ç«¯ï¼ˆé€‚ç”¨äºä»»ä½•æ¨ç†æä¾›å•†ï¼Œ`huggingface/inference`æ”¯æŒè¿œç¨‹å’Œæœ¬åœ°ç«¯ç‚¹ï¼‰
- ä¸€ç»„MCPå®¢æˆ·ç«¯ä¼šè¯ï¼Œæ¯ä¸ªè¿æ¥çš„MCPæœåŠ¡å™¨ä¸€ä¸ªï¼ˆè¿™å…è®¸æˆ‘ä»¬è¿æ¥åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„GradioæœåŠ¡å™¨ï¼‰
- ä»¥åŠä¸€ä¸ªå¯ç”¨å·¥å…·åˆ—è¡¨ï¼Œå®ƒå°†ä»è¿æ¥çš„æœåŠ¡å™¨ä¸­å¡«å……å¹¶ç¨å¾®é‡æ–°æ ¼å¼åŒ–ã€‚

```ts
export class McpClient {
	protected client: InferenceClient;
	protected provider: string;
	protected model: string;
	private clients: Map<ToolName, Client> = new Map();
	public readonly availableTools: ChatCompletionInputTool[] = [];

	constructor({ provider, model, apiKey }: { provider: InferenceProvider; model: string; apiKey: string }) {
		this.client = new InferenceClient(apiKey);
		this.provider = provider;
		this.model = model;
	}
	
	// [...]
}
```

è¦è¿æ¥åˆ°MCPæœåŠ¡å™¨ï¼ˆå¦‚æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ï¼‰ï¼Œå®˜æ–¹çš„`@modelcontextprotocol/sdk/client` TypeScript SDKæä¾›äº†ä¸€ä¸ªå¸¦æœ‰`listTools()`æ–¹æ³•çš„`Client`ç±»ï¼š

```ts
async addMcpServer(server: StdioServerParameters): Promise<void> {
	const transport = new StdioClientTransport({
		...server,
		env: { ...server.env, PATH: process.env.PATH ?? "" },
	});
	const mcp = new Client({ name: "@huggingface/mcp-client", version: packageVersion });
	await mcp.connect(transport);

	const toolsResult = await mcp.listTools();
	debug(
		"Connected to server with tools:",
		toolsResult.tools.map(({ name }) => name)
	);

	for (const tool of toolsResult.tools) {
		this.clients.set(tool.name, mcp);
	}

	this.availableTools.push(
		...toolsResult.tools.map((tool) => {
			return {
				type: "function",
				function: {
					name: tool.name,
					description: tool.description,
					parameters: tool.inputSchema,
				},
			} satisfies ChatCompletionInputTool;
		})
	);
}
```

`StdioServerParameters`æ˜¯æ¥è‡ªMCP SDKçš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒå°†è®©ä½ è½»æ¾ç”Ÿæˆä¸€ä¸ªæœ¬åœ°è¿›ç¨‹ï¼šæ­£å¦‚æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œç›®å‰æ‰€æœ‰MCPæœåŠ¡å™¨å®é™…ä¸Šéƒ½æ˜¯æœ¬åœ°è¿›ç¨‹ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„GradioæœåŠ¡å™¨ï¼ˆå°½ç®¡æˆ‘ä»¬é€šè¿‡HTTPè®¿é—®å®ƒï¼‰ã€‚

å¯¹äºæˆ‘ä»¬è¿æ¥çš„æ¯ä¸ªMCPæœåŠ¡å™¨ï¼ˆåŒ…æ‹¬æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ï¼‰ï¼Œæˆ‘ä»¬ç¨å¾®é‡æ–°æ ¼å¼åŒ–å…¶å·¥å…·åˆ—è¡¨å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°`this.availableTools`ä¸­ã€‚

### å¦‚ä½•ä½¿ç”¨å·¥å…·

ä½¿ç”¨æˆ‘ä»¬çš„æƒ…æ„Ÿåˆ†æå·¥å…·ï¼ˆæˆ–ä»»ä½•å…¶ä»–MCPå·¥å…·ï¼‰å¾ˆç®€å•ã€‚ä½ åªéœ€å°†`this.availableTools`ä¼ é€’ç»™ä½ çš„LLMèŠå¤©å®Œæˆï¼Œé™¤äº†ä½ é€šå¸¸çš„æ¶ˆæ¯æ•°ç»„ï¼š

```ts
const stream = this.client.chatCompletionStream({
	provider: this.provider,
	model: this.model,
	messages,
	tools: this.availableTools,
	tool_choice: "auto",
});
```

`tool_choice: "auto"`æ˜¯ä½ ä¼ é€’çš„å‚æ•°ï¼Œè®©LLMç”Ÿæˆé›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·è°ƒç”¨ã€‚

åœ¨è§£ææˆ–æµå¼ä¼ è¾“è¾“å‡ºæ—¶ï¼ŒLLMå°†ç”Ÿæˆä¸€äº›å·¥å…·è°ƒç”¨ï¼ˆå³å‡½æ•°åç§°å’Œä¸€äº›JSONç¼–ç çš„å‚æ•°ï¼‰ï¼Œä½ éœ€è¦ï¼ˆä½œä¸ºå¼€å‘è€…ï¼‰è®¡ç®—è¿™äº›è°ƒç”¨ã€‚MCPå®¢æˆ·ç«¯SDKå†æ¬¡ä½¿è¿™å˜å¾—éå¸¸å®¹æ˜“ï¼›å®ƒæœ‰ä¸€ä¸ª`client.callTool()`æ–¹æ³•ï¼š

```ts
const toolName = toolCall.function.name;
const toolArgs = JSON.parse(toolCall.function.arguments);

const toolMessage: ChatCompletionInputMessageTool = {
	role: "tool",
	tool_call_id: toolCall.id,
	content: "",
	name: toolName,
};

/// è·å–æ­¤å·¥å…·çš„é€‚å½“ä¼šè¯
const client = this.clients.get(toolName);
if (client) {
	const result = await client.callTool({ name: toolName, arguments: toolArgs });
	toolMessage.content = result.content[0].text;
} else {
	toolMessage.content = `Error: No session found for tool: ${toolName}`;
}
```

å¦‚æœLLMé€‰æ‹©ä½¿ç”¨æˆ‘ä»¬çš„æƒ…æ„Ÿåˆ†æå·¥å…·ï¼Œè¿™æ®µä»£ç å°†è‡ªåŠ¨å°†è°ƒç”¨è·¯ç”±åˆ°æˆ‘ä»¬çš„GradioæœåŠ¡å™¨ï¼Œæ‰§è¡Œåˆ†æï¼Œå¹¶å°†ç»“æœè¿”å›ç»™LLMã€‚

æœ€åï¼Œä½ å°†æŠŠç”Ÿæˆçš„å·¥å…·æ¶ˆæ¯æ·»åŠ åˆ°ä½ çš„`messages`æ•°ç»„ä¸­å¹¶è¿”å›ç»™LLMã€‚

## æˆ‘ä»¬çš„50è¡Œä»£ç Agent ğŸ¤¯

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªèƒ½å¤Ÿè¿æ¥åˆ°ä»»æ„MCPæœåŠ¡å™¨ï¼ˆåŒ…æ‹¬æˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ï¼‰ä»¥è·å–å·¥å…·åˆ—è¡¨çš„MCPå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†å®ƒä»¬æ³¨å…¥å¹¶ä»LLMæ¨ç†ä¸­è§£æå‡ºæ¥ï¼Œé‚£ä¹ˆ...ä»€ä¹ˆæ˜¯Agentï¼Ÿ

> ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªå¸¦æœ‰ä¸€ç»„å·¥å…·çš„æ¨ç†å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆAgentå°±åªæ˜¯å®ƒä¸Šé¢çš„ä¸€ä¸ªwhileå¾ªç¯ã€‚

æ›´è¯¦ç»†åœ°è¯´ï¼ŒAgentåªæ˜¯ä»¥ä¸‹å†…å®¹çš„ç»„åˆï¼š
- ä¸€ä¸ªç³»ç»Ÿæç¤º
- ä¸€ä¸ªLLMæ¨ç†å®¢æˆ·ç«¯
- ä¸€ä¸ªMCPå®¢æˆ·ç«¯ï¼Œç”¨äºä»ä¸€å †MCPæœåŠ¡å™¨ï¼ˆåŒ…æ‹¬æˆ‘ä»¬çš„GradioæœåŠ¡å™¨ï¼‰ä¸­é’©å…¥ä¸€ç»„å·¥å…·
- ä¸€äº›åŸºæœ¬çš„æ§åˆ¶æµï¼ˆè§ä¸‹é¢çš„whileå¾ªç¯ï¼‰

> [!TIP]
> å®Œæ•´çš„`Agent.ts`ä»£ç æ–‡ä»¶åœ¨[è¿™é‡Œ](https://github.com/huggingface/huggingface.js/blob/main/packages/mcp-client/src/Agent.ts)ã€‚

æˆ‘ä»¬çš„Agentç±»ç®€å•åœ°æ‰©å±•äº†McpClientï¼š

```ts
export class Agent extends McpClient {
	private readonly servers: StdioServerParameters[];
	protected messages: ChatCompletionInputMessage[];

	constructor({
		provider,
		model,
		apiKey,
		servers,
		prompt,
	}: {
		provider: InferenceProvider;
		model: string;
		apiKey: string;
		servers: StdioServerParameters[];
		prompt?: string;
	}) {
		super({ provider, model, apiKey });
		this.servers = servers;
		this.messages = [
			{
				role: "system",
				content: prompt ?? DEFAULT_SYSTEM_PROMPT,
			},
		];
	}
}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„ç³»ç»Ÿæç¤ºï¼Œçµæ„Ÿæ¥è‡ª[GPT-4.1æç¤ºæŒ‡å—](https://cookbook.openai.com/examples/gpt4-1_prompting_guide)ä¸­åˆ†äº«çš„æç¤ºã€‚

å°½ç®¡è¿™æ¥è‡ªOpenAI ğŸ˜ˆï¼Œä½†è¿™å¥è¯ç‰¹åˆ«é€‚ç”¨äºè¶Šæ¥è¶Šå¤šçš„æ¨¡å‹ï¼ŒåŒ…æ‹¬é—­æºå’Œå¼€æºçš„ï¼š

> æˆ‘ä»¬é¼“åŠ±å¼€å‘è€…ä¸“é—¨ä½¿ç”¨toolså­—æ®µæ¥ä¼ é€’å·¥å…·ï¼Œè€Œä¸æ˜¯åƒè¿‡å»ä¸€äº›äººæŠ¥å‘Šçš„é‚£æ ·ï¼Œæ‰‹åŠ¨å°†å·¥å…·æè¿°æ³¨å…¥åˆ°ä½ çš„æç¤ºä¸­å¹¶ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„å·¥å…·è°ƒç”¨è§£æå™¨ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æç¤ºä¸­æä¾›ç²¾å¿ƒæ ¼å¼åŒ–çš„å·¥å…·ä½¿ç”¨ç¤ºä¾‹åˆ—è¡¨ã€‚`tools: this.availableTools`å‚æ•°å°±è¶³å¤Ÿäº†ï¼ŒLLMå°†çŸ¥é“å¦‚ä½•ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå·¥å…·å’Œæˆ‘ä»¬çš„Gradioæƒ…æ„Ÿåˆ†æå·¥å…·ã€‚

åœ¨Agentä¸ŠåŠ è½½å·¥å…·å®é™…ä¸Šåªæ˜¯è¿æ¥åˆ°æˆ‘ä»¬æƒ³è¦çš„MCPæœåŠ¡å™¨ï¼ˆå¹¶è¡Œè¿›è¡Œï¼Œå› ä¸ºåœ¨JSä¸­å¾ˆå®¹æ˜“åšåˆ°ï¼‰ï¼š

```ts
async loadTools(): Promise<void> {
	await Promise.all(this.servers.map((s) => this.addMcpServer(s)));
}
```

æˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªé¢å¤–çš„å·¥å…·ï¼ˆåœ¨MCPä¹‹å¤–ï¼‰ï¼ŒLLMå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ§åˆ¶æˆ‘ä»¬çš„Agentçš„æµç¨‹ï¼š

```ts
const taskCompletionTool: ChatCompletionInputTool = {
	type: "function",
	function: {
		name: "task_complete",
		description: "å½“ç”¨æˆ·ç»™å®šçš„ä»»åŠ¡å®Œæˆæ—¶è°ƒç”¨æ­¤å·¥å…·",
		parameters: {
			type: "object",
			properties: {},
		},
	},
};
const askQuestionTool: ChatCompletionInputTool = {
	type: "function",
	function: {
		name: "ask_question",
		description: "å‘ç”¨æˆ·æé—®ä»¥è·å–è§£å†³æˆ–æ¾„æ¸…ä»–ä»¬é—®é¢˜æ‰€éœ€çš„æ›´å¤šä¿¡æ¯ã€‚",
		parameters: {
			type: "object",
			properties: {},
		},
	},
};
const exitLoopTools = [taskCompletionTool, askQuestionTool];
```

å½“è°ƒç”¨è¿™äº›å·¥å…·ä¸­çš„ä»»ä½•ä¸€ä¸ªæ—¶ï¼ŒAgentå°†æ‰“ç ´å…¶å¾ªç¯å¹¶å°†æ§åˆ¶æƒäº¤è¿˜ç»™ç”¨æˆ·ä»¥è·å–æ–°çš„è¾“å…¥ã€‚

### å®Œæ•´çš„whileå¾ªç¯

çœ‹æˆ‘ä»¬çš„å®Œæ•´whileå¾ªç¯ã€‚ğŸ‰

æˆ‘ä»¬çš„Agentä¸»whileå¾ªç¯çš„è¦ç‚¹æ˜¯ï¼Œæˆ‘ä»¬åªéœ€ä¸LLMè¿­ä»£ï¼Œåœ¨å·¥å…·è°ƒç”¨å’Œå‘å…¶æä¾›å·¥å…·ç»“æœä¹‹é—´äº¤æ›¿ï¼Œæˆ‘ä»¬è¿™æ ·åš**ç›´åˆ°LLMå¼€å§‹è¿ç»­å“åº”ä¸¤ä¸ªéå·¥å…·æ¶ˆæ¯**ã€‚

è¿™æ˜¯å®Œæ•´çš„whileå¾ªç¯ï¼š

```ts
let numOfTurns = 0;
let nextTurnShouldCallTools = true;
while (true) {
	try {
		yield* this.processSingleTurnWithTools(this.messages, {
			exitLoopTools,
			exitIfFirstChunkNoTool: numOfTurns > 0 && nextTurnShouldCallTools,
			abortSignal: opts.abortSignal,
		});
	} catch (err) {
		if (err instanceof Error && err.message === "AbortError") {
			return;
		}
		throw err;
	}
	numOfTurns++;
	const currentLast = this.messages.at(-1)!;
	if (
		currentLast.role === "tool" &&
		currentLast.name &&
		exitLoopTools.map((t) => t.function.name).includes(currentLast.name)
	) {
		return;
	}
	if (currentLast.role !== "tool" && numOfTurns > MAX_NUM_TURNS) {
		return;
	}
	if (currentLast.role !== "tool" && nextTurnShouldCallTools) {
		return;
	}
	if (currentLast.role === "tool") {
		nextTurnShouldCallTools = false;
	} else {
		nextTurnShouldCallTools = true;
	}
}
```

## å°†Tiny Agentsä¸Gradio MCPæœåŠ¡å™¨è¿æ¥

ç°åœ¨æˆ‘ä»¬å·²ç»ç†è§£äº†Tiny Agentså’ŒGradio MCPæœåŠ¡å™¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼MCPçš„ç¾å¦™ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼ï¼Œè®©æ™ºèƒ½ä½“å¯ä»¥ä¸ä»»ä½•MCPå…¼å®¹çš„æœåŠ¡å™¨äº¤äº’ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åŸºäºGradioçš„æƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ã€‚

### å°†Tiny Agentsä¸GradioæœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨

è¦å°†æˆ‘ä»¬çš„Tiny Agentè¿æ¥åˆ°æˆ‘ä»¬ä¹‹å‰æ„å»ºçš„Gradioæƒ…æ„Ÿåˆ†ææœåŠ¡å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•ä¿®æ”¹æˆ‘ä»¬çš„agenté…ç½®ï¼š

```ts
const agent = new Agent({
    provider: process.env.PROVIDER ?? "nebius",
    model: process.env.MODEL_ID ?? "Qwen/Qwen2.5-72B-Instruct",
    apiKey: process.env.HF_TOKEN,
    servers: [
        // ... ç°æœ‰æœåŠ¡å™¨ ...
        {
            command: "npx",
            args: [
                "mcp-remote",
                "http://localhost:7860/gradio_api/mcp/sse"  // ä½ çš„Gradio MCPæœåŠ¡å™¨
            ]
        }
    ],
});
```

ç°åœ¨æˆ‘ä»¬çš„agentå¯ä»¥ä¸å…¶ä»–å·¥å…·ä¸€èµ·ä½¿ç”¨æƒ…æ„Ÿåˆ†æå·¥å…·ï¼ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ï¼š
1. ä½¿ç”¨æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ä»æ–‡ä»¶ä¸­è¯»å–æ–‡æœ¬
2. ä½¿ç”¨æˆ‘ä»¬çš„GradioæœåŠ¡å™¨åˆ†æå…¶æƒ…æ„Ÿ
3. å°†ç»“æœå†™å›æ–‡ä»¶

### ç¤ºä¾‹äº¤äº’

ä»¥ä¸‹æ˜¯ä¸æˆ‘ä»¬çš„agentçš„å¯¹è¯å¯èƒ½çš„æ ·å­ï¼š

```
ç”¨æˆ·ï¼šä»æˆ‘æ¡Œé¢è¯»å–æ–‡ä»¶"feedback.txt"å¹¶åˆ†æå…¶æƒ…æ„Ÿ

Agentï¼šæˆ‘å°†å¸®åŠ©ä½ åˆ†æåé¦ˆæ–‡ä»¶çš„æƒ…æ„Ÿã€‚è®©æˆ‘åˆ†æ­¥éª¤è¿›è¡Œï¼š

1. é¦–å…ˆï¼Œæˆ‘å°†ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå·¥å…·è¯»å–æ–‡ä»¶
2. ç„¶åï¼Œæˆ‘å°†ä½¿ç”¨æƒ…æ„Ÿåˆ†æå·¥å…·åˆ†æå…¶æƒ…æ„Ÿ
3. æœ€åï¼Œæˆ‘å°†æŠŠç»“æœå†™å…¥æ–°æ–‡ä»¶

[Agentç»§ç»­ä½¿ç”¨å·¥å…·å¹¶æä¾›åˆ†æ]
```

### éƒ¨ç½²æ³¨æ„äº‹é¡¹

å½“ä½ å°†Gradio MCPæœåŠ¡å™¨éƒ¨ç½²åˆ°Hugging Face Spacesæ—¶ï¼Œä½ éœ€è¦æ›´æ–°agenté…ç½®ä¸­çš„æœåŠ¡å™¨URLï¼ŒæŒ‡å‘ä½ éƒ¨ç½²çš„ç©ºé—´ï¼š

```ts
{
    command: "npx",
    args: [
        "mcp-remote",
        "https://YOUR_USERNAME-mcp-sentiment.hf.space/gradio_api/mcp/sse"
    ]
}
```

è¿™å…è®¸ä½ çš„agentä»ä»»ä½•åœ°æ–¹ä½¿ç”¨æƒ…æ„Ÿåˆ†æå·¥å…·ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æœ¬åœ°ï¼



