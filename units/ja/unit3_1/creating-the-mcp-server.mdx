# MCPã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆ

MCPã‚µãƒ¼ãƒãƒ¼ã¯ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿ƒè‡“éƒ¨ã§ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒHugging Face Hubã€ç‰¹ã«ãƒ¢ãƒ‡ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¿ã‚°ã®èª­ã¿å–ã‚Šã¨æ›´æ–°ã«ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€FastMCPã¨Hugging Face Hub Python SDKã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## MCPã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£

MCPã‚µãƒ¼ãƒãƒ¼ã¯2ã¤ã®é‡è¦ãªãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ï¼š

| ãƒ„ãƒ¼ãƒ« | èª¬æ˜ |
| --- | --- |
| `get_current_tags` | ãƒ¢ãƒ‡ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰æ—¢å­˜ã®ã‚¿ã‚°ã‚’å–å¾— |
| `add_new_tag` | ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆçµŒç”±ã§ãƒªãƒã‚¸ãƒˆãƒªã«æ–°ã—ã„ã‚¿ã‚°ã‚’è¿½åŠ  |

ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Hub APIã¨ã®ã‚„ã‚Šå–ã‚Šã®è¤‡é›‘ã•ã‚’æŠ½è±¡åŒ–ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ“ä½œã™ã‚‹ãŸã‚ã®ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

![MCP Server Tools](https://huggingface.co/datasets/mcp-course/images/resolve/main/unit3/architecture.png)

## å®Œå…¨ãªMCPã‚µãƒ¼ãƒãƒ¼å®Ÿè£…

`mcp_server.py`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ®µéšçš„ã«ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãã‚Œã‚‰ãŒã©ã®ã‚ˆã†ã«é€£æºã™ã‚‹ã‹ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã€æ®µéšçš„ã«æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

### 1. ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨è¨­å®š

ã¾ãšã€å¿…è¦ãªã™ã¹ã¦ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

```python
#!/usr/bin/env python3
"""
Simplified MCP Server for HuggingFace Hub Tagging Operations using FastMCP
"""

import os
import json
from fastmcp import FastMCP
from huggingface_hub import HfApi, model_info, ModelCard, ModelCardData
from huggingface_hub.utils import HfHubHTTPError
from dotenv import load_dotenv

load_dotenv()
```

ä¸Šè¨˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ˆã‚Šã€MCPã‚µãƒ¼ãƒãƒ¼ã®æ§‹ç¯‰ã«å¿…è¦ãªã™ã¹ã¦ã®ã‚‚ã®ãŒæƒã„ã¾ã™ã€‚`FastMCP`ã¯ã‚µãƒ¼ãƒãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æä¾›ã—ã€`huggingface_hub`ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ãƒ¢ãƒ‡ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¨ã®ã‚„ã‚Šå–ã‚Šã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚

`load_dotenv()`ã®å‘¼ã³å‡ºã—ã¯ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¿ã€é–‹ç™ºä¸­ã«APIãƒˆãƒ¼ã‚¯ãƒ³ãªã©ã®ç§˜å¯†æƒ…å ±ã‚’ç®¡ç†ã—ã‚„ã™ãã—ã¾ã™ã€‚

<Tip>

uvã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã€`uv run`ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯`load_dotenv()`ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

</Tip>

æ¬¡ã«ã€å¿…è¦ãªèªè¨¼æƒ…å ±ã§ã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã—ã€FastMCPã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ï¼š

```python
# Configuration
HF_TOKEN = os.getenv("HF_TOKEN")

# Initialize HF API client
hf_api = HfApi(token=HF_TOKEN) if HF_TOKEN else None

# Create the FastMCP server
mcp = FastMCP("hf-tagging-bot")
```

ã“ã®è¨­å®šãƒ–ãƒ­ãƒƒã‚¯ã¯3ã¤ã®é‡è¦ãªã“ã¨ã‚’è¡Œã„ã¾ã™ï¼š
1. ç’°å¢ƒå¤‰æ•°ã‹ã‚‰Hugging Faceãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
2. èªè¨¼ã•ã‚ŒãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãŒåˆ©ç”¨ã§ãã‚‹å ´åˆã®ã¿ï¼‰
3. èª¬æ˜çš„ãªåå‰ã§FastMCPã‚µãƒ¼ãƒãƒ¼ã‚’åˆæœŸåŒ–

`hf_api`ã®æ¡ä»¶çš„ãªä½œæˆã«ã‚ˆã‚Šã€ãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§ã‚‚ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã§ãã‚‹ãŸã‚ã€åŸºæœ¬çš„ãªæ§‹é€ ã®ãƒ†ã‚¹ãƒˆã«å½¹ç«‹ã¡ã¾ã™ã€‚

### 2. ç¾åœ¨ã®ã‚¿ã‚°å–å¾—ãƒ„ãƒ¼ãƒ«

æœ€åˆã®ãƒ„ãƒ¼ãƒ« - `get_current_tags`ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ¢ãƒ‡ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰æ—¢å­˜ã®ã‚¿ã‚°ã‚’å–å¾—ã—ã¾ã™ï¼š

```python
@mcp.tool()
def get_current_tags(repo_id: str) -> str:
    """Get current tags from a HuggingFace model repository"""
    print(f"ğŸ”§ get_current_tags called with repo_id: {repo_id}")

    if not hf_api:
        error_result = {"error": "HF token not configured"}
        json_str = json.dumps(error_result)
        print(f"âŒ No HF API token - returning: {json_str}")
        return json_str
```

ã“ã®é–¢æ•°ã¯æ¤œè¨¼ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ - èªè¨¼ã•ã‚ŒãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚Pythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªãJSONæ–‡å­—åˆ—ã‚’è¿”ã™ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯MCPé€šä¿¡ã«ãŠã„ã¦é‡è¦ã§ã™ã€‚

<Tip>

ã™ã¹ã¦ã®MCPãƒ„ãƒ¼ãƒ«ã¯ã€Pythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªãæ–‡å­—åˆ—ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€çµæœã‚’JSONæ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«`json.dumps()`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€MCPã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã®ä¿¡é ¼æ€§ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿äº¤æ›ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

</Tip>

`get_current_tags`é–¢æ•°ã®ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼š

```python
    try:
        print(f"ğŸ“¡ Fetching model info for: {repo_id}")
        info = model_info(repo_id=repo_id, token=HF_TOKEN)
        current_tags = info.tags if info.tags else []
        print(f"ğŸ·ï¸ Found {len(current_tags)} tags: {current_tags}")

        result = {
            "status": "success",
            "repo_id": repo_id,
            "current_tags": current_tags,
            "count": len(current_tags),
        }
        json_str = json.dumps(result)
        print(f"âœ… get_current_tags returning: {json_str}")
        return json_str

    except Exception as e:
        print(f"âŒ Error in get_current_tags: {str(e)}")
        error_result = {"status": "error", "repo_id": repo_id, "error": str(e)}
        json_str = json.dumps(error_result)
        print(f"âŒ get_current_tags error returning: {json_str}")
        return json_str
```

ã“ã®å®Ÿè£…ã¯æ˜ç¢ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã£ã¦ã„ã¾ã™ï¼š
1. **ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—** - Hugging Face Hub APIã‚’ä½¿ç”¨
2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†** - ã‚¿ã‚°æƒ…å ±ã‚’æŠ½å‡º
3. **çµæœã‚’æ§‹é€ åŒ–** - ä¸€è²«ã—ãŸJSONå½¢å¼ã§
4. **ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†** - è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã¨ã‚‚ã«

<Tip>

åºƒç¯„å›²ãªãƒ­ã‚°å‡ºåŠ›ã¯éå‰°ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã‚µãƒ¼ãƒãƒ¼å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒãƒƒã‚°ã¨ç›£è¦–ã«å½¹ç«‹ã¡ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Hubã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã«è‡ªå¾‹çš„ã«åå¿œã™ã‚‹ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’ç¢ºèªã§ããªã„ã“ã¨ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚

</Tip>

### 3. æ–°ã—ã„ã‚¿ã‚°è¿½åŠ ãƒ„ãƒ¼ãƒ«

ã‚ˆã‚Šè¤‡é›‘ãªãƒ„ãƒ¼ãƒ« - `add_new_tag`ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã«æ–°ã—ã„ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã™ã€‚åˆæœŸè¨­å®šã¨æ¤œè¨¼ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼š

```python
@mcp.tool()
def add_new_tag(repo_id: str, new_tag: str) -> str:
    """Add a new tag to a HuggingFace model repository via PR"""
    print(f"ğŸ”§ add_new_tag called with repo_id: {repo_id}, new_tag: {new_tag}")

    if not hf_api:
        error_result = {"error": "HF token not configured"}
        json_str = json.dumps(error_result)
        print(f"âŒ No HF API token - returning: {json_str}")
        return json_str
```

æœ€åˆã®ãƒ„ãƒ¼ãƒ«ã¨åŒæ§˜ã«ã€æ¤œè¨¼ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚æ¬¡ã«ã€ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªçŠ¶æ…‹ã‚’å–å¾—ã—ã¦ã€ã‚¿ã‚°ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```python
    try:
        # Get current model info and tags
        print(f"ğŸ“¡ Fetching current model info for: {repo_id}")
        info = model_info(repo_id=repo_id, token=HF_TOKEN)
        current_tags = info.tags if info.tags else []
        print(f"ğŸ·ï¸ Current tags: {current_tags}")

        # Check if tag already exists
        if new_tag in current_tags:
            print(f"âš ï¸ Tag '{new_tag}' already exists in {current_tags}")
            result = {
                "status": "already_exists",
                "repo_id": repo_id,
                "tag": new_tag,
                "message": f"Tag '{new_tag}' already exists",
            }
            json_str = json.dumps(result)
            print(f"ğŸ·ï¸ add_new_tag (already exists) returning: {json_str}")
            return json_str
```

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯é‡è¦ãªåŸå‰‡ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š**è¡Œå‹•ã™ã‚‹å‰ã«æ¤œè¨¼ã™ã‚‹**ã€‚ä¸è¦ãªãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆã‚’é¿ã‘ã‚‹ãŸã‚ã€ã‚¿ã‚°ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

<Tip>

å¤‰æ›´ã‚’è¡Œã†å‰ã«å¿…ãšç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é‡è¤‡ä½œæ¥­ã‚’é˜²ãã€ã‚ˆã‚Šè‰¯ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã§ãã¾ã™ã€‚ç‰¹ã«ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹éš›ã¯é‡è¦ã§ã€é‡è¤‡ã—ãŸãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’ä¹±é›‘ã«ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

</Tip>

æ¬¡ã«ã€æ›´æ–°ã•ã‚ŒãŸã‚¿ã‚°ãƒªã‚¹ãƒˆã‚’æº–å‚™ã—ã€ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’å‡¦ç†ã—ã¾ã™ï¼š

```python
        # Add the new tag to existing tags
        updated_tags = current_tags + [new_tag]
        print(f"ğŸ†• Will update tags from {current_tags} to {updated_tags}")

        # Create model card content with updated tags
        try:
            # Load existing model card
            print(f"ğŸ“„ Loading existing model card...")
            card = ModelCard.load(repo_id, token=HF_TOKEN)
            if not hasattr(card, "data") or card.data is None:
                card.data = ModelCardData()
        except HfHubHTTPError:
            # Create new model card if none exists
            print(f"ğŸ“„ Creating new model card (none exists)")
            card = ModelCard("")
            card.data = ModelCardData()

        # Update tags - create new ModelCardData with updated tags
        card_dict = card.data.to_dict()
        card_dict["tags"] = updated_tags
        card.data = ModelCardData(**card_dict)
```

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚’å‡¦ç†ã—ã¾ã™ã€‚æœ€åˆã«æ—¢å­˜ã®ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚‚ã†ã¨ã—ã¾ã™ãŒã€å­˜åœ¨ã—ãªã„å ´åˆã¯æ–°ã—ã„ã‚‚ã®ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ„ãƒ¼ãƒ«ãŒç©ºã®ãƒªãƒã‚¸ãƒˆãƒªã§ã‚‚å‹•ä½œã™ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ï¼ˆ`README.md`ï¼‰ã«ã¯ã€ã‚¿ã‚°ã‚’å«ã‚€ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¢ãƒ‡ãƒ«ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã®ãŸã‚ã®æ¨™æº–çš„ãªHugging Faceãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å¾“ã£ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ - ãƒ„ãƒ¼ãƒ«ã®ãƒ¡ã‚¤ãƒ³éƒ¨åˆ†ã§ã™ï¼š

```python
        # Create a pull request with the updated model card
        pr_title = f"Add '{new_tag}' tag"
        pr_description = f"""
## Add tag: {new_tag}

This PR adds the `{new_tag}` tag to the model repository.

**Changes:**
- Added `{new_tag}` to model tags
- Updated from {len(current_tags)} to {len(updated_tags)} tags

**Current tags:** {", ".join(current_tags) if current_tags else "None"}
**New tags:** {", ".join(updated_tags)}

ğŸ¤– This is a pull request created by the Hugging Face Hub Tagging Bot.
"""

        print(f"ğŸš€ Creating PR with title: {pr_title}")
```

ä½•ãŒå¤‰æ›´ã•ã‚Œã‚‹ã‹ã€ãªãœå¤‰æ›´ã•ã‚Œã‚‹ã‹ã‚’èª¬æ˜ã™ã‚‹è©³ç´°ãªãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®èª¬æ˜ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®é€æ˜æ€§ã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ãƒ³ãƒ†ãƒŠã«ã¨ã£ã¦é‡è¦ã§ã™ã€‚

<Tip>

æ˜ç¢ºã§è©³ç´°ãªãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®èª¬æ˜ã¯ã€è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯ä¸å¯æ¬ ã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ãƒ³ãƒ†ãƒŠãŒä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚’ç†è§£ã—ã€å¤‰æ›´ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦æƒ…å ±ã«åŸºã¥ã„ãŸæ±ºå®šã‚’ä¸‹ã™ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã¾ãŸã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸã“ã¨ã‚’æ˜ç¢ºã«è¿°ã¹ã‚‹ã“ã¨ã‚‚è‰¯ã„æ…£è¡Œã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ãƒ³ãƒ†ãƒŠãŒãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã™ã‚‹ã‹ã‚’ç†è§£ã§ãã¾ã™ã€‚

</Tip>

æœ€å¾Œã«ã€ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

```python
        # Create commit with updated model card using CommitOperationAdd
        from huggingface_hub import CommitOperationAdd

        commit_info = hf_api.create_commit(
            repo_id=repo_id,
            operations=[
                CommitOperationAdd(
                    path_in_repo="README.md", path_or_fileobj=str(card).encode("utf-8")
                )
            ],
            commit_message=pr_title,
            commit_description=pr_description,
            token=HF_TOKEN,
            create_pr=True,
        )

        # Extract PR URL from commit info
        pr_url_attr = commit_info.pr_url
        pr_url = pr_url_attr if hasattr(commit_info, "pr_url") else str(commit_info)

        print(f"âœ… PR created successfully! URL: {pr_url}")

        result = {
            "status": "success",
            "repo_id": repo_id,
            "tag": new_tag,
            "pr_url": pr_url,
            "previous_tags": current_tags,
            "new_tags": updated_tags,
            "message": f"Created PR to add tag '{new_tag}'",
        }
        json_str = json.dumps(result)
        print(f"âœ… add_new_tag success returning: {json_str}")
        return json_str
```

`create_pr=True`ã‚’æŒ‡å®šã—ãŸ`create_commit`é–¢æ•°ãŒè‡ªå‹•åŒ–ã®éµã§ã™ã€‚æ›´æ–°ã•ã‚ŒãŸ`README.md`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã—ã€è‡ªå‹•çš„ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é–‹ãã¾ã™ã€‚

ã“ã®è¤‡é›‘ãªæ“ä½œã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¿˜ã‚Œãšã«ï¼š

```python
    except Exception as e:
        print(f"âŒ Error in add_new_tag: {str(e)}")
        print(f"âŒ Error type: {type(e)}")
        import traceback
        print(f"âŒ Traceback: {traceback.format_exc()}")

        error_result = {
            "status": "error",
            "repo_id": repo_id,
            "tag": new_tag,
            "error": str(e),
        }
        json_str = json.dumps(error_result)
        print(f"âŒ add_new_tag error returning: {json_str}")
        return json_str
```

åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã¯å®Œå…¨ãªãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒƒã‚¯ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€å•é¡ŒãŒç™ºç”Ÿã—ãŸã¨ãã®ãƒ‡ãƒãƒƒã‚°ã«éå¸¸ã«ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµµæ–‡å­—ã¯é¦¬é¹¿ã’ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãƒ­ã‚°ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’ã¯ã‚‹ã‹ã«é«˜é€Ÿã«ã—ã¾ã™ã€‚é–¢æ•°å‘¼ã³å‡ºã—ã«ğŸ”§ã€APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ğŸ“¡ã€æˆåŠŸã«âœ…ã€ã‚¨ãƒ©ãƒ¼ã«âŒã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ¢ã—ã¦ã„ã‚‹ã‚‚ã®ã‚’ã™ã°ã‚„ãè¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¤è¦–è¦šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

<Tip>

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹é–“ã€èª¤ã£ã¦ç„¡é™ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã‚„ã™ã„ã§ã™ã€‚ã“ã‚Œã¯ã€`create_pr=True`ã‚’æŒ‡å®šã—ãŸ`create_commit`é–¢æ•°ãŒã€ã™ã¹ã¦ã®ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ãŸã‚ã§ã™ã€‚ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒãƒ¼ã‚¸ã•ã‚Œãªã„å ´åˆã€`create_commit`é–¢æ•°ãŒå†åº¦ã€å†åº¦ã€å†åº¦å‘¼ã³å‡ºã•ã‚Œã¾ã™...

ã“ã‚Œã‚’é˜²ããŸã‚ã®ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸãŒã€æ³¨æ„ã™ã¹ãç‚¹ã§ã™ã€‚

</Tip>

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

å …ç‰¢ãªã‚¿ã‚°ä»˜ã‘ãƒ„ãƒ¼ãƒ«ã‚’å‚™ãˆãŸMCPã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè£…ã§ããŸã®ã§ã€æ¬¡ã«å¿…è¦ãªã“ã¨ã¯ï¼š

1. **MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ** - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨MCPã‚µãƒ¼ãƒãƒ¼é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ§‹ç¯‰
2. **Webhookå‡¦ç†ã®å®Ÿè£…** - Hubãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³
3. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã®çµ±åˆ** - Webhookã¨MCPãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’æ¥ç¶š
4. **å®Œå…¨ãªã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆ** - ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æ©Ÿèƒ½ã®æ¤œè¨¼

æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Webhookå‡¦ç†æ©Ÿèƒ½ãŒã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã«ã‚„ã‚Šå–ã‚Šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

<Tip>

MCPã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®åˆ†é›¢ã«ã‚ˆã‚Šã€ã‚ˆã‚Šã‚ˆã„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæä¾›ã•ã‚Œã€è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒ¼ãƒãƒ¼ã‚’å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

</Tip> 